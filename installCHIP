
Manual Install
These steps will walk you through setting up an AnyfestoBox on a CHIP http://docs.getchip.com/chip.html
Anyfesto on a CHIP 9$ computer
N.B. This set up will use CHIPs wlan1 for the captive portal,dnsmasq, etc etc. wlan0 is left free to connect to backhaul, the 
     intertubes  or whatever network you may want. No bridge has been set up by default. Lots of ideas for use of this.
     ToDo - Add USB mount and links into the Content directory.
=======================================================================================
Parts List
   CHIP - https://getchip.com/pages/store - $ 9.00
   USB Stick 32GB or Bigger - Many Sources - $20.00 - upward
   LIon Battery 3.7V 2500mA - https://www.adafruit.com/products/328 - $29.50
   5V 2.4A 6' MicroUSB Cable - https://www.adafruit.com/products/1995 - $ 7.95 

----------------------------------------
CHIP comes with a preinstalled Debain based OS with desktop and apps. If you want something slimmer flash 
your CHIP with a Debian Server (http://docs.getchip.com/chip.html#flash-chip-with-an-os)

sudo apt-get -y install vlc
sudo adduser --no-create-home --shell /bin/false --disabled-password vlc
sudo usermod -G audio,chip vlc
sudo apt-get -y install lighttpd
sudo /etc/init.d/lighttpd stop
sudo update-rc.d lighttpd remove
sudo apt-get -y install dnsmasq 
sudo /etc/init.d/dnsmasq  stop
sudo update-rc.d dnsmasq remove 
sudo apt-get -y  install hostapd
sudo /etc/init.d/hostapd  stop
sudo update-rc.d hostapd remove 
sudo apt-get -y install git
sudo apt-get -y install perl sox libsox-fmt-all libav-tools
sudo rm /bin/sh
sudo ln /bin/bash /bin/sh
sudo chmod a+rw /bin/sh

mkdir /home/chip/content
mkdir /home/chip/content/Radio
sudo usermod -d /home/chip/content/Radio vlc

==Install and Config Piratebox Base

wget  http://downloads.piratebox.de/piratebox-ws_current.tar.gz
tar xzf piratebox-ws_current.tar.gz
cd piratebox
sudo mkdir -p  /opt
sudo cp -rv  piratebox /opt
cd /opt/piratebox
sudo sed 's:DROOPY_USE_USER="no":DROOPY_USE_USER="yes":' -i  /opt/piratebox/conf/piratebox.conf
sudo ln -s /opt/piratebox/init.d/piratebox /etc/init.d/piratebox
sudo update-rc.d piratebox  defaults 
sudo ln -s /home/chip/content /opt/piratebox/share/Shared/Archives   
sudo nano /opt/piratebox/conf/piratebox.conf     #Change the following and save
      HOST="anyfestochip.lan"
      INTERFACE="wlan1"
      DNSMASQ_INTERFACE="wlan1"
      NET=10.11.99    

sudo nano /opt/piratebox/conf/hostapd.conf       #Add/Change the following and save
      interface=wlan1
      driver=nl80211
      ssid=AnyfestoCHIPCommunityNetworking
      channel=1
      ctrl_interface=/var/run/hostapd
      
sudo nano /etc/default/hostapd                   #Change the following and save
    DAEMON_CONF="/opt/piratebox/conf/hostapd.conf"


sudo nano /usr/share/vlc/lua/http/.hosts           #Add/Change the following and save
    ::1
    127.0.0.1
    fc00::/7
    fec0::/10
    10.0.0.0/8
    192.0.0.0/8
sudo mkdir /etc/vlc 
cd /usr/share/vlc/lua/http/ 
sudo mv .hosts /etc/vlc 
sudo ln -s /etc/vlc/.hosts .hosts
cd /home/pi/content/Radio
wget https://archive.org/download/Old_Radio_Public_Service_Announcements/OldRadio_Pub--Jack_Benny_Tolerance1.mp3  -O welcome.mp3
sudo nano /etc/vlc/start.sh                        #Add the follwing and save   
    #!/bin/sh
    sudo service hostapd start
    VLC_PORT=8088
    VLC_USER=vlc
    VLC_IP=10.11.99.1
    VLC_PASWD=changeme
    sudo -u vlc cvlc -vvv -I http --http-password $VLC_PASWD  --http-host $VLC_IP --http-port $VLC_PORT  --sout-keep --sout='#duplicate{dst=rtp{mux=ts,dst=10.11.99.1:8086},dst=gather:std{access=http,mux=mpeg1,dst=:8085},dst=display,select="novideo"}'  --loop  /home/chip/content/Radio/welcome.mp3
sudo chmod a+rx /etc/vlc/start.sh  
sudo nano /etc/rc.local                           #Add the follwing and save    
      /etc/vlc/start.sh &
cd /opt/piratebox/www
rm index.html
sudo wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/AnyfestoCHiP-index.html -O index.html
sudo wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/anyfestochiplogosm.jpg -O logo.jpg

sudo /etc/init.d/piratebox start

sudo sync 
sudo reboot

----------------------------------------------------------------------------
Optional - Add Mumble Server for secure voip and chat
sudo apt-get install mumble-server
sudo dpkg-reconfigure mumble-server
   Autostart:  Yes
   High Priority: No
   SuperUser: Set the admin password
sudo nano /etc/mumble-server.ini
    Find welcomeText and update to whatever you would like displayed when a user joins
    Find serverpassword and update if you would like a password for users, leave as is to  have no password for users.
sudo /etc/init.d/mumble-server restart 
# Add a link in /opt/piratebox/www/index.html to service and clients

------------------------------------------------------------------------------
Optional - Add Kiwix to serve up Wikipedia and other wikimedia sites
cd ~
wget https://download.kiwix.org/bin/kiwix-server-arm.tar.bz2
bzip2 -d kiwix-server-arm.tar.bz2 
tar xvf kiwix-server-arm.tar
rm kiwix-server-arm.tar 

