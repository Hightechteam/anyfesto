=======================================================================================

These steps will walk you through setting up an AnyfestoBox on a CHIP http://docs.getchip.com/chip.html
Anyfesto on a CHIP 9$ computer
N.B. This set up will use CHIPs wlan1 for the captive portal,dnsmasq, etc etc. wlan0 is left free to connect to backhaul, the 
     intertubes  or whatever network you may want. No bridge has been set up by default. Lots of ideas for use of this.
    
=======================================================================================
Parts List
   CHIP - https://getchip.com/pages/store - $ 9.00
   USB Stick 32GB or Bigger - Many Sources - $20.00 - upward
   LIon Battery 3.7V 2500mA - https://www.adafruit.com/products/328 - $29.50
   5V 2.4A 6' MicroUSB Cable - https://www.adafruit.com/products/1995 - $ 7.95 
   USB OTG cable
----------------------------------------
This install assumes a fresh out of the baggie CHIP. If you want a bit more room and have no plans on using this CHIP for GUI purposes 
head on ever to https://docs.getchip.com/chip.html#flash-chip-with-an-os and follow the instructions to install the Headless version 
that is a great base for servers. 
This install has been tested on a 4.4 Headless setup. YMMV
----------------------------------------
=Connect to the CHIP
 -Connect your chip to a USB port on your computer using a USB OTG cable. This will give you both power and connectivity.
 -I uses the Headless Connection method, other methods are available. Please consult https://docs.getchip.com/chip.html 
 -for more connectivity options. 
 -Open a terminal
 sudo screen $(ls -tw 1 /dev/tty* | head -1) 115200
 -Login to the CHIP with username: chip password: chip
 -Change the default password
 passwd
 -Connect to the wifi network of your choice
 sudo nmcli device wifi connect '(your wifi network name/SSID)' password '(your wifi password)' ifname wlan0

===========================================================================================
Sripted Installation
===========================================================================================

wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/CHIPinstall.sh
bash CHIPinstall.sh


===========================================================================================
or Manual Installation
===========================================================================================
=Installing the Basic Packages and Infrastructure
sudo apt-get -y update
sudo apt-get -y upgrade
sudo apt-get -y install locales
sudo locale-gen en_US en_US.UTF-8
sudo apt-get -y install vlc
sudo adduser --no-create-home --shell /bin/false --disabled-password vlc
sudo usermod -G audio,chip vlc
sudo apt-get -y install lighttpd
sudo apt-get -y install dnsmasq
sudo apt-get -y install isc-dhcp-server
sudo apt-get -y install hostapd
sudo apt-get -y install git zip unzip
sudo apt-get -y install perl sox libsox-fmt-all libav-tools
sudo rm /bin/sh
sudo ln /bin/bash /bin/sh
sudo chmod a+rw /bin/sh

= Setup the Directories and lighttpd 
mkdir /home/chip/content
mkdir /home/chip/content/Radio
sudo usermod -d /home/chip/content/Radio vlc
sudo ln -s /home/chip/content /var/www/html/content   
cd /var/www/html
sudo rm index*.html
sudo wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/AnyfestoCHiP-index.html -O index.html
sudo wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/anyfestochiplogosm.jpg -O logo.jpg
cd ~
wget https://github.com/twbs/bootstrap/releases/download/v3.3.7/bootstrap-3.3.7-dist.zip
unzip bootstrap-3.3.7-dist.zip 
sudo cp -r bootstrap-3.3.7-dist/* /var/www/html/
cd /var/www/html/css
sudo wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/carousel.css
cd /var/www/html/js
sudo wget https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js

=Setup Network and Captive Portal 
cd ~
mkdir configs
cd configs
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/dhcpd.conf 
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/dnsmasq.conf
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/hostapd
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/hostapd.conf
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/interfaces
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/isc-dhcp-server
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/start.sh
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/lighttpd.conf
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/vlchosts
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/hosts
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/hostname
wget https://raw.githubusercontent.com/tomhiggins/anyfesto/master/deployables/current/rclocal
sudo chown root:root *
sudo chmod a+rx *

sudo mv -f dhcpd.conf /etc/dhcp/dhcpd.conf
sudo mv -f dnsmasq.conf /etc/dnsmasq.conf
sudo mv -f hostapd /etc/default/hostapd
sudo mv -f hostapd.conf /etc/hostapd/hostapd.conf 
sudo mv -f interfaces /etc/network/interfaces 
sudo mv -f isc-dhcp-server /etc/default/isc-dhcp-server
sudo mv -f lighttpd.conf /etc/lighttpd/lighttpd.conf
sudo mv -f vlchosts /usr/share/vlc/lua/http/.hosts
sudo mv -f hosts /etc/hosts
sudo mv -f hostname /etc/hostname
sudo mv -f rclocal /etc/rc.local

=Setup Audio Streaming using VLC
sudo mkdir /etc/vlc 
cd /usr/share/vlc/lua/http/ 
sudo mv .hosts /etc/vlc 
sudo ln -s /etc/vlc/.hosts .hosts
cd /home/chip/content/Radio
wget https://archive.org/download/Old_Radio_Public_Service_Announcements/OldRadio_Pub--Jack_Benny_Tolerance1.mp3  -O welcome.mp3
sudo mv -f ~/configs/start.sh /etc/vlc/start.sh  
sudo chmod a+rx /etc/vlc/start.sh

sudo sync 
sudo reboot

-You shoud now have a base Anyfesto Install. Congrats. 
----------------------------------------------------------------------------
Going Further
------------------------------------------------------------------------------------
-To add more packages, do administration or fix what needs fixing reconnect to the CHIP either via the Headless Method outlined
-above or by using your own method. The following will bring down your AP and reconnect you to the internet Wifi AP of your choosing.

sudo ifconfig wlan1 down        
sudo ifconfig wlan0 down
sudo nmcli device wifi connect '(your wifi network name/SSID)' password '(your wifi password)' ifname wlan0
-Add options, new packages, make changes. 
-When you are done with the changes
sudo sync 
sudo reboot

----------------------------------------------------------------------------
Adding a USB Drive
----------------------------------------------------------------------------
-Connect the usb drive to the usb port
sudo mkdir /drives
sudo mount /dev/sda1 /drives
sudo nano /etc/fstab                     #Add/Change the following and save
   /dev/sda1 /drives vfat defaults 0 0
sudo mount -a                            #drive will now automount on boot. If you disconect the drive and reattach it run sudo mount -a again

-Adding a Direcotry on the USB Drive to the shared file listing (these will show up uner the Files selection of the Web Page)
sudo ln -s /drives/(NameOfDirectory)/ /home/chip/content/

-Example - for my test setup 
  sudo ln -s /drives/SpokenWord/ /home/chip/content/
  sudo ln -s /drives/Books/ /home/chip/content/
  sudo ln -s /drives/Audio/ /home/chip/content/


----------------------------------------------------------------------------
Optional - Add Mumble Server for secure voip and chat
----------------------------------------------------------------------------
sudo apt-get install mumble-server
sudo dpkg-reconfigure mumble-server
   Autostart:  Yes
   High Priority: No
   SuperUser: Set the admin password
sudo nano /etc/mumble-server.ini
    Find welcomeText and update to whatever you would like displayed when a user joins
    Find serverpassword and update if you would like a password for users, leave as is to  have no password for users.
sudo /etc/init.d/mumble-server restart 
# Add a link in /var/www/html/index.html to service and clients

------------------------------------------------------------------------------
Optional - Add Kiwix to serve up Wikipedia and other wikimedia sites
------------------------------------------------------------------------------
cd ~
wget https://download.kiwix.org/bin/kiwix-server-arm.tar.bz2
bzip2 -d kiwix-server-arm.tar.bz2 
tar xvf kiwix-server-arm.tar
rm kiwix-server-arm.tar
sudo cp kiwix-serve /usr/bin/kiwix-serve
sudo cp kiwix-manage /usr/bin/kiwix-manage
sudo mkdir /drives/kiwix
     # You can find a list of premade data stores at http://www.kiwix.org/wiki/Content . Use non indexed ones. 
cd /drives/kiwix
sudo wget http://download.kiwix.org/zim/wikipedia_en_for-schools.zim  # your milage may vary
# If you want to add several zims  wget them to /drives/kiwix and then use kiwiz-manage to create a libray file
# For each zim add it to the library
sudo kiwix-manage /drives/kiwix/library.xml /drives/kiwix/NameOfZimFile.zim 
sudo nano /etc/rc.local                                           # add the line and save
   /usr/bin/kiwix-serve --daemon --port=8099 /drives/kiwix/wikipedia_en_for-schools.zim
   # If you are using multiple zim files use this line
   /usr/bin/kiwix-serve --daemon --port=8099 --library /drives/kiwix/library.xml
sudo sync
sudo reboot
# Add a description and link  to http://10.11.99.1:8099 to /var/www/html/index.html

